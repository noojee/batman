logPath: /var/log/batman.log

emailServerFQDN: localhost
emailServerPort: 25
emailFromAddress: scanner@mydomain.com



file_integrity:
  report_on_success: false
  report_to: failed.scan@mydomain.com

  # List of file system entities (directories and/or files) that are to be included in the baseline
  entities:
    - /home/bsutton/home 
    # - /sbin
    # - /usr/bin
    # - /usr/sbin
    # - /etc
    # - /opt

  # List of file system entities (files or directories) that are to be excluded from the baseline.
  # These entities must be children of one of the directories
  # listed in the entities section.
  exclusions:
    - /dev
    - /sys
    - /proc
    - /tmp
    - /run
    - /home
    - /mnt/stateful_partition/home
    - /mnt/stateful_partition/var/lib/cni
    - /mnt/stateful_partition/var/lib/docker/containers
    - /mnt/stateful_partition/var/lib/docker/image
    - /mnt/stateful_partition/var/lib/docker/overlay2
    - /mnt/stateful_partition/var/lib/docker/network
    - /mnt/stateful_partition/var/lib/docker/volumes
    - /mnt/stateful_partition/var/lib/dockershim
    - /mnt/stateful_partition/var/lib/kubelet/pods
    - /mnt/stateful_partition/var/lib/metrics
    - /mnt/stateful_partition/var/lib/update_engine/prefs
    - /mnt/stateful_partition/var/log
    - /mnt/stateful_partition/var_overlay
    - /var/lib/cni
    - /var/lib/docker/containers
    - /var/lib/docker/image
    - /var/lib/docker/network
    - /var/lib/docker/overlay2
    - /var/lib/docker/volumes
    - /var/lib/dockershim
    - /var/lib/kubelet/plugins
    - /var/lib/kubelet/pods
    - /var/lib/metrics
    - /var/lib/update_engine/prefs
    - /var/log
    - /log/journal



# define the set of rules and log sources that need to be
# audited.
log_audits:
  log_sources:
    - log_source:
      type: file
      description: File Integrity logs
      report_to: support@someone.online
      top: 1000
      path: /var/log/batman.log
      trim_prefix: ':::'
      rules:
        - rule: integrity check
        - rule: errors
      
        
    - log_source:
      type: njcontact
      name: frequency
      description: Group Logging lines - by java source and line no.
      report_to: support@someone.online
      top: 10
      reset: Starting Servlet engine
      trim_prefix: '::: [0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3}'
      rules:
        - rule: njcontact-frequency


    - log_source:
      type: njcontact
      name: njcontact
      description: Noojee Contact logs
      report_to: support@someone.online
      top: 1000
      reset: Starting Servlet engine
      trim_prefix: ':::'
      rules:
        - rule: creditcard
        - rule: errors
        - rule: njcontact
          

      
  rules:
    - rule:
      name: creditcard
      description: Scans for credit cards 
      selectors:
        - selector:
          type: creditcard
          description: A credit card was detected
          risk: critical

    - rule:
      name: integrity check
      description: Scans the file integrity logs for issues
      selectors:
        - selector:
          type: contains
          description: The contents of a file has changed which may indicate an intruder.
          match: ['Integrity:']
          risk: critical
          continue: false
        - selector:
          description: A baseline scan failed to process a file due to permission denied.
          type: contains
          match: ['permission denied']
          risk: medium
          continue: false

    - rule:
      name: errors
      description: Scans for errors.
      selectors:
        - selector:
          type: contains
          description: An error was detected
          match: ['Error']
          risk: high
          continue: false

    - rule:
      name: warnings
      description: Scans for warnings.
      selectors:
        - selector:
          type: contains
          description: a warning was detected
          match: ['Warning']
          risk: medium
          continue: false

    - rule:
      name: njcontact-frequency
      description: High frequency java logs.
      group_by: '(.*?\.java\:.*?)'
      selectors:
        - selector:
          type: contains
          description: Identify java code generating high levels of logging.
          match: [".java"]
          risk: low
      
    - rule:
      name: njcontact
      description: errors specific to the noojee contact log source
      selectors:
        - selector:
          description: ignore deleterious lines
          type: contains
          continue: false
          match: 
            - 'AgiHangupException'
            - 'Setting logging level to'
            - 'com.mysql.cj.'
            - 'RejectedExecutionHandlerImpl'
            - 'Logs begin at'
            - 'LoggingOutputStream'
          risk: none
        - selector:
          description: The java VM is pausing excessively due to GC.
          type: contains
          match: ["jvm pause"]
        - selector:
          description: Locker
          type: contains
          match: ["Locker"]
          risk: medium
        - selector:
          description: Slow
          type: contains
          match: ["Slow"]
          risk: low
        - selector:
          description: Java is reporting an out of memory condition
          type: contains
          match: ["Terminating due to java.lang.OutOfMemoryError"]
          risk: high
        - selector:
          description: Saving a lead failed due to a wrong or no lead.
          type: contains
          match: ["Unable to save changes (Wrong or no lead)"]
          risk: high

  